<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Portal | Glitch Tech Services</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%230a0e27'/%3E%3Cpath d='M30 20 L50 50 L30 80 L40 80 L60 50 L40 20 Z' fill='%2300ff41' opacity='0.8'/%3E%3Cpath d='M45 20 L65 50 L45 80 L55 80 L75 50 L55 20 Z' fill='%2300ff41'/%3E%3Ccircle cx='25' cy='25' r='3' fill='%2300ff41'/%3E%3Ccircle cx='75' cy='25' r='3' fill='%2300ff41'/%3E%3Ccircle cx='25' cy='75' r='3' fill='%2300ff41'/%3E%3Ccircle cx='75' cy='75' r='3' fill='%2300ff41'/%3E%3C/svg%3E">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=IBM+Plex+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --neon-green: #00ff41;
            --dark-bg: #0a0e27;
            --darker-bg: #050810;
            --card-bg: rgba(15, 20, 40, 0.9);
            --border-glow: rgba(0, 255, 65, 0.3);
        }

        body {
            font-family: 'IBM Plex Sans', sans-serif;
            background: var(--dark-bg);
            color: #e0e0e0;
            min-height: 100vh;
            position: relative;
        }

        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.15;
            background: 
                linear-gradient(90deg, transparent 49%, var(--neon-green) 49%, var(--neon-green) 51%, transparent 51%),
                linear-gradient(0deg, transparent 49%, var(--neon-green) 49%, var(--neon-green) 51%, transparent 51%);
            background-size: 50px 50px;
            animation: gridPulse 4s ease-in-out infinite;
        }

        @keyframes gridPulse {
            0%, 100% { opacity: 0.1; }
            50% { opacity: 0.2; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        header {
            padding: 20px 0;
            border-bottom: 2px solid var(--border-glow);
            background: rgba(10, 14, 39, 0.9);
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 900;
            color: var(--neon-green);
            text-shadow: 0 0 20px rgba(0, 255, 65, 0.5);
        }

        .back-link {
            color: var(--neon-green);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .back-link:hover {
            text-shadow: 0 0 10px var(--neon-green);
        }

        /* Auth Container */
        .auth-container {
            max-width: 450px;
            margin: 80px auto;
            background: var(--card-bg);
            border: 2px solid var(--border-glow);
            border-radius: 10px;
            padding: 40px;
        }

        .auth-container h2 {
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-green);
            margin-bottom: 30px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #b0b0b0;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-glow);
            border-radius: 5px;
            color: #e0e0e0;
            font-size: 1rem;
            font-family: 'IBM Plex Sans', sans-serif;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--neon-green);
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.3);
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: var(--neon-green);
            color: var(--dark-bg);
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Orbitron', sans-serif;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 255, 65, 0.4);
        }

        .toggle-auth {
            text-align: center;
            margin-top: 20px;
            color: #888;
        }

        .toggle-auth a {
            color: var(--neon-green);
            cursor: pointer;
            text-decoration: none;
        }

        .toggle-auth a:hover {
            text-decoration: underline;
        }

        /* Dashboard */
        .dashboard {
            display: none;
            padding: 40px 0;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .dashboard-header h1 {
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-green);
        }

        .logout-btn {
            padding: 10px 20px;
            background: transparent;
            border: 2px solid var(--neon-green);
            color: var(--neon-green);
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: var(--neon-green);
            color: var(--dark-bg);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--card-bg);
            border: 2px solid var(--border-glow);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
        }

        .stat-card h3 {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .stat-card .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            color: var(--neon-green);
            font-weight: 700;
        }

        /* Sections */
        .section {
            background: var(--card-bg);
            border: 2px solid var(--border-glow);
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .section h2 {
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-green);
            margin-bottom: 20px;
        }

        /* Book Repair Button */
        .book-repair-btn {
            padding: 15px 30px;
            background: var(--neon-green);
            color: var(--dark-bg);
            border: none;
            border-radius: 5px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            transition: all 0.3s;
            display: inline-block;
            margin-bottom: 30px;
        }

        .book-repair-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 255, 65, 0.5);
        }

        /* Repair Items */
        .repair-item {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-glow);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .repair-item h3 {
            color: var(--neon-green);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .repair-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .repair-info-item {
            font-size: 0.9rem;
        }

        .repair-info-item strong {
            color: #888;
        }

        /* Status Timeline */
        .status-timeline {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            position: relative;
        }

        .status-timeline::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background: #333;
            z-index: 0;
        }

        .status-step {
            text-align: center;
            position: relative;
            z-index: 1;
            flex: 1;
        }

        .status-dot {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #333;
            border: 2px solid #555;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .status-step.active .status-dot {
            background: var(--neon-green);
            border-color: var(--neon-green);
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.6);
            color: var(--dark-bg);
        }

        .status-step.completed .status-dot {
            background: var(--neon-green);
            border-color: var(--neon-green);
            color: var(--dark-bg);
        }

        .status-label {
            font-size: 0.8rem;
            color: #888;
        }

        .status-step.active .status-label,
        .status-step.completed .status-label {
            color: var(--neon-green);
        }

        /* Messages */
        .messages-container {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-glow);
            border-radius: 8px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .message {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
        }

        .message.from-tech {
            background: rgba(0, 255, 65, 0.1);
            border-left: 3px solid var(--neon-green);
        }

        .message.from-customer {
            background: rgba(100, 100, 100, 0.1);
            border-left: 3px solid #666;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.85rem;
            color: #888;
        }

        .message-sender {
            color: var(--neon-green);
            font-weight: 600;
        }

        .message-content {
            color: #e0e0e0;
        }

        .message-form {
            display: flex;
            gap: 10px;
        }

        .message-input {
            flex: 1;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-glow);
            border-radius: 5px;
            color: #e0e0e0;
        }

        .message-input:focus {
            outline: none;
            border-color: var(--neon-green);
        }

        .send-btn {
            padding: 12px 24px;
            background: var(--neon-green);
            color: var(--dark-bg);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .send-btn:hover {
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.5);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        /* Alert */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert.error {
            background: rgba(255, 0, 0, 0.1);
            border-color: #ff0000;
            color: #ff6b6b;
        }

        .alert.success {
            background: rgba(0, 255, 65, 0.1);
            border-color: var(--neon-green);
            color: var(--neon-green);
        }

        .hidden {
            display: none !important;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            overflow-y: auto;
        }

        .modal-content {
            background: var(--card-bg);
            margin: 5% auto;
            padding: 40px;
            border: 2px solid var(--border-glow);
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .close-modal {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 2rem;
            font-weight: bold;
            color: #888;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: var(--neon-green);
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">GLITCH TECH PORTAL</div>
                <a href="index.html" class="back-link">‚Üê Back to Main Site</a>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Login/Signup Form -->
        <div class="auth-container" id="authContainer">
            <h2 id="authTitle">Customer Login</h2>
            
            <div id="alertContainer"></div>

            <form id="authForm">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" required placeholder="your@email.com">
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>

                <div class="form-group hidden" id="nameGroup">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" placeholder="John Doe">
                </div>

                <div class="form-group hidden" id="phoneGroup">
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" placeholder="(305) 555-1234">
                </div>

                <button type="submit" class="btn" id="authButton">Login</button>
            </form>

            <div class="toggle-auth">
                <span id="toggleText">Don't have an account?</span>
                <a id="toggleLink">Sign Up</a>
            </div>
        </div>

        <!-- Dashboard -->
        <div class="dashboard" id="dashboard">
            <div class="dashboard-header">
                <h1>Welcome, <span id="customerName">Customer</span>!</h1>
                <button class="logout-btn" id="logoutBtn">Logout</button>
            </div>

            <button class="book-repair-btn" id="bookRepairBtn">üìÖ Book a Repair</button>

            <!-- Stats -->
            <div class="dashboard-grid">
                <div class="stat-card">
                    <h3>Active Repairs</h3>
                    <div class="stat-value" id="activeRepairs">0</div>
                </div>
                <div class="stat-card">
                    <h3>Completed</h3>
                    <div class="stat-value" id="completedRepairs">0</div>
                </div>
                <div class="stat-card">
                    <h3>Total Spent</h3>
                    <div class="stat-value" id="totalSpent">$0</div>
                </div>
            </div>

            <!-- Current Repairs -->
            <div class="section">
                <h2>Current Repairs</h2>
                <div id="currentRepairs">
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <p>No active repairs. Book one to get started!</p>
                    </div>
                </div>
            </div>

            <!-- Messages -->
            <div class="section">
                <h2>Messages</h2>
                <div class="messages-container" id="messagesContainer">
                    <div class="empty-state">
                        <div class="empty-state-icon">üí¨</div>
                        <p>No messages yet.</p>
                    </div>
                </div>
                <div class="message-form">
                    <input type="text" class="message-input" id="messageInput" placeholder="Type your message...">
                    <button class="send-btn" id="sendMessage">Send</button>
                </div>
            </div>

            <!-- Repair History -->
            <div class="section">
                <h2>Repair History</h2>
                <div id="repairHistory">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <p>No repair history yet.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Book Repair Modal -->
    <div class="modal" id="bookRepairModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeBookingModal()">&times;</span>
            <h2 style="font-family: 'Orbitron', sans-serif; color: var(--neon-green); margin-bottom: 20px;">Book a Repair</h2>
            
            <form id="bookingForm">
                <div class="form-group">
                    <label for="deviceType">Device Type *</label>
                    <select id="deviceType" required>
                        <option value="">Select device type...</option>
                        <option value="laptop">Laptop</option>
                        <option value="desktop">Desktop</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="brand">Brand/Model</label>
                    <input type="text" id="brand" placeholder="e.g., Dell Latitude, HP Pavilion">
                </div>

                <div class="form-group">
                    <label for="issue">What's the problem? *</label>
                    <textarea id="issue" required placeholder="Describe what's wrong with your computer..."></textarea>
                </div>

                <div class="form-group">
                    <label for="serviceType">Service Needed *</label>
                    <select id="serviceType" required>
                        <option value="">Select service...</option>
                        <option value="virus">Virus/Malware Removal ($50-80)</option>
                        <option value="hardware">Hardware Repair ($60-150)</option>
                        <option value="data">Data Recovery ($75-200)</option>
                        <option value="tuneup">Performance Tune-Up ($40-60)</option>
                        <option value="os">OS Installation ($60-100)</option>
                        <option value="diagnostic">Diagnostic Only ($30)</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="urgency">How urgent is this?</label>
                    <select id="urgency">
                        <option value="normal">Normal (1-3 days)</option>
                        <option value="urgent">Urgent (same day +$30)</option>
                    </select>
                </div>

                <button type="submit" class="btn">Submit Repair Request</button>
            </form>
        </div>
    </div>

    <script>
        // Simple localStorage-based system
        let isLogin = true;
        let currentUser = null;

        // Get all users from localStorage
        function getAllUsers() {
            return JSON.parse(localStorage.getItem('glitchTechUsers') || '[]');
        }

        // Save user to localStorage
        function saveUser(user) {
            const users = getAllUsers();
            users.push(user);
            localStorage.setItem('glitchTechUsers', JSON.stringify(users));
        }

        // Update user
        function updateUser(user) {
            const users = getAllUsers();
            const index = users.findIndex(u => u.email === user.email);
            if (index !== -1) {
                users[index] = user;
                localStorage.setItem('glitchTechUsers', JSON.stringify(users));
            }
        }

        // Find user by email
        function findUser(email) {
            const users = getAllUsers();
            return users.find(u => u.email === email);
        }

        // DOM Elements
        const authContainer = document.getElementById('authContainer');
        const dashboard = document.getElementById('dashboard');
        const authForm = document.getElementById('authForm');
        const authTitle = document.getElementById('authTitle');
        const authButton = document.getElementById('authButton');
        const toggleText = document.getElementById('toggleText');
        const toggleLink = document.getElementById('toggleLink');
        const nameGroup = document.getElementById('nameGroup');
        const phoneGroup = document.getElementById('phoneGroup');
        const alertContainer = document.getElementById('alertContainer');
        const customerName = document.getElementById('customerName');
        const logoutBtn = document.getElementById('logoutBtn');

        // Toggle between login and signup
        toggleLink.addEventListener('click', () => {
            isLogin = !isLogin;
            if (isLogin) {
                authTitle.textContent = 'Customer Login';
                authButton.textContent = 'Login';
                toggleText.textContent = "Don't have an account?";
                toggleLink.textContent = 'Sign Up';
                nameGroup.classList.add('hidden');
                phoneGroup.classList.add('hidden');
            } else {
                authTitle.textContent = 'Create Account';
                authButton.textContent = 'Sign Up';
                toggleText.textContent = 'Already have an account?';
                toggleLink.textContent = 'Login';
                nameGroup.classList.remove('hidden');
                phoneGroup.classList.remove('hidden');
            }
        });

        // Handle auth form
        authForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (isLogin) {
                // Login
                const user = findUser(email);
                if (user && user.password === password) {
                    currentUser = user;
                    showDashboard();
                } else {
                    showAlert('Invalid email or password.', 'error');
                }
            } else {
                // Signup
                const name = document.getElementById('name').value;
                const phone = document.getElementById('phone').value;
                
                if (findUser(email)) {
                    showAlert('Account already exists with this email.', 'error');
                    return;
                }

                // Generate verification code
                const verificationCode = Math.floor(100000 + Math.random() * 900000);
                
                // Show verification prompt
                const code = prompt(`A verification code has been sent to ${email}\n\nIn a real system, you'd receive an email. For demo purposes, your code is: ${verificationCode}\n\nPlease enter the code:`);
                
                if (!code || code !== verificationCode.toString()) {
                    showAlert('Invalid verification code. Please try again.', 'error');
                    return;
                }

                const newUser = {
                    email: email,
                    password: password,
                    name: name,
                    phone: phone,
                    repairs: [],
                    messages: [],
                    history: [],
                    verified: true
                };

                saveUser(newUser);
                showAlert('Account created and verified! You can now login.', 'success');
                setTimeout(() => {
                    isLogin = true;
                    toggleLink.click();
                }, 2000);
            }
        });

        // Logout
        logoutBtn.addEventListener('click', () => {
            currentUser = null;
            dashboard.style.display = 'none';
            authContainer.style.display = 'block';
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
        });

        // Show alert
        function showAlert(message, type) {
            alertContainer.innerHTML = `<div class="alert ${type}">${message}</div>`;
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }

        // Show dashboard
        function showDashboard() {
            authContainer.style.display = 'none';
            dashboard.style.display = 'block';
            customerName.textContent = currentUser.name;

            // Load stats
            const activeCount = currentUser.repairs.filter(r => r.status !== 'completed').length;
            const completedCount = currentUser.repairs.filter(r => r.status === 'completed').length;
            const totalSpent = currentUser.repairs.reduce((sum, r) => {
                const cost = parseInt((r.actualCost || r.estimatedCost || '0').replace(/\D/g, ''));
                return sum + (r.status === 'completed' ? cost : 0);
            }, 0);

            document.getElementById('activeRepairs').textContent = activeCount;
            document.getElementById('completedRepairs').textContent = completedCount;
            document.getElementById('totalSpent').textContent = `$${totalSpent}`;

            // Load sections
            loadCurrentRepairs();
            loadMessages();
            loadHistory();
        }

        // Load current repairs
        function loadCurrentRepairs() {
            const container = document.getElementById('currentRepairs');
            const active = currentUser.repairs.filter(r => r.status !== 'completed');

            if (active.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <p>No active repairs. Book one to get started!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = active.map(repair => `
                <div class="repair-item">
                    <h3>${repair.device}</h3>
                    <div class="repair-info">
                        <div class="repair-info-item">
                            <strong>Issue:</strong> ${repair.issue}
                        </div>
                        <div class="repair-info-item">
                            <strong>Service:</strong> ${repair.serviceType}
                        </div>
                        <div class="repair-info-item">
                            <strong>Requested:</strong> ${repair.dateRequested}
                        </div>
                        <div class="repair-info-item">
                            <strong>Estimate:</strong> ${repair.estimatedCost}
                        </div>
                    </div>
                    ${repair.notes ? `<p style="color: #b0b0b0; margin-top: 10px;"><strong>Tech Notes:</strong> ${repair.notes}</p>` : ''}
                    
                    <div class="status-timeline">
                        <div class="status-step ${repair.status === 'pending' || repair.status === 'received' || repair.status === 'diagnosing' || repair.status === 'repairing' || repair.status === 'ready' ? 'completed' : ''}">
                            <div class="status-dot">‚úì</div>
                            <div class="status-label">Pending</div>
                        </div>
                        <div class="status-step ${repair.status === 'received' || repair.status === 'diagnosing' || repair.status === 'repairing' || repair.status === 'ready' ? 'completed' : repair.status === 'pending' ? 'active' : ''}">
                            <div class="status-dot">${repair.status === 'received' || repair.status === 'diagnosing' || repair.status === 'repairing' || repair.status === 'ready' ? '‚úì' : ''}</div>
                            <div class="status-label">Received</div>
                        </div>
                        <div class="status-step ${repair.status === 'diagnosing' || repair.status === 'repairing' || repair.status === 'ready' ? 'completed' : repair.status === 'received' ? 'active' : ''}">
                            <div class="status-dot">${repair.status === 'diagnosing' || repair.status === 'repairing' || repair.status === 'ready' ? '‚úì' : ''}</div>
                            <div class="status-label">Diagnosing</div>
                        </div>
                        <div class="status-step ${repair.status === 'repairing' || repair.status === 'ready' ? 'completed' : repair.status === 'diagnosing' ? 'active' : ''}">
                            <div class="status-dot">${repair.status === 'repairing' || repair.status === 'ready' ? '‚úì' : ''}</div>
                            <div class="status-label">Repairing</div>
                        </div>
                        <div class="status-step ${repair.status === 'ready' ? 'active' : ''}">
                            <div class="status-dot"></div>
                            <div class="status-label">Ready</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Load messages
        function loadMessages() {
            const container = document.getElementById('messagesContainer');
            
            if (currentUser.messages.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üí¨</div>
                        <p>No messages yet.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = currentUser.messages.map(msg => `
                <div class="message ${msg.from === 'tech' ? 'from-tech' : 'from-customer'}">
                    <div class="message-header">
                        <span class="message-sender">${msg.from === 'tech' ? 'Glitch Tech' : 'You'}</span>
                        <span class="message-time">${msg.time}</span>
                    </div>
                    <div class="message-content">${msg.content}</div>
                </div>
            `).join('');

            container.scrollTop = container.scrollHeight;
        }

        // Send message
        document.getElementById('sendMessage').addEventListener('click', () => {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();

            if (message) {
                const now = new Date();
                const time = now.toLocaleString('en-US', { 
                    month: '2-digit', 
                    day: '2-digit', 
                    year: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true 
                }).replace(',', '');

                currentUser.messages.push({
                    from: 'customer',
                    content: message,
                    time: time
                });

                updateUser(currentUser);
                input.value = '';
                loadMessages();
            }
        });

        // Enter key sends message
        document.getElementById('messageInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('sendMessage').click();
            }
        });

        // Load history
        function loadHistory() {
            const container = document.getElementById('repairHistory');
            const completed = currentUser.repairs.filter(r => r.status === 'completed');

            if (completed.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <p>No repair history yet.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = completed.map(repair => `
                <div class="repair-item">
                    <h3>${repair.device}</h3>
                    <div class="repair-info">
                        <div class="repair-info-item">
                            <strong>Issue:</strong> ${repair.issue}
                        </div>
                        <div class="repair-info-item">
                            <strong>Service:</strong> ${repair.serviceType}
                        </div>
                        <div class="repair-info-item">
                            <strong>Date:</strong> ${repair.dateRequested}
                        </div>
                        <div class="repair-info-item">
                            <strong>Cost:</strong> ${repair.actualCost}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Book Repair
        document.getElementById('bookRepairBtn').addEventListener('click', () => {
            document.getElementById('bookRepairModal').style.display = 'block';
        });

        function closeBookingModal() {
            document.getElementById('bookRepairModal').style.display = 'none';
        }

        // Handle booking form
        document.getElementById('bookingForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const deviceType = document.getElementById('deviceType').value;
            const brand = document.getElementById('brand').value;
            const issue = document.getElementById('issue').value;
            const serviceType = document.getElementById('serviceType').value;
            const urgency = document.getElementById('urgency').value;

            const newRepair = {
                id: 'R' + Date.now(),
                device: brand || deviceType,
                issue: issue,
                serviceType: serviceType,
                urgency: urgency,
                status: 'pending',
                dateRequested: new Date().toLocaleDateString(),
                estimatedCost: getEstimatedCost(serviceType, urgency),
                notes: ''
            };

            currentUser.repairs.push(newRepair);
            
            // Add welcome message
            const now = new Date();
            const time = now.toLocaleString('en-US', { 
                month: '2-digit', 
                day: '2-digit', 
                year: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                hour12: true 
            }).replace(',', '');

            currentUser.messages.push({
                from: 'tech',
                content: `Thanks for booking! I received your repair request for ${deviceType} (${serviceType}). I'll review it and get back to you shortly!`,
                time: time
            });

            updateUser(currentUser);
            closeBookingModal();
            showDashboard();
            showAlert('Repair booked successfully! We\'ll be in touch soon.', 'success');

            // Reset form
            document.getElementById('bookingForm').reset();
        });

        function getEstimatedCost(serviceType, urgency) {
            let cost = '';
            switch(serviceType) {
                case 'virus': cost = '$50-80'; break;
                case 'hardware': cost = '$60-150'; break;
                case 'data': cost = '$75-200'; break;
                case 'tuneup': cost = '$40-60'; break;
                case 'os': cost = '$60-100'; break;
                case 'diagnostic': cost = '$30'; break;
                default: cost = 'TBD';
            }
            if (urgency === 'urgent') {
                cost += ' (+$30 rush)';
            }
            return cost;
        }

        // Close modal on outside click
        window.addEventListener('click', (e) => {
            const modal = document.getElementById('bookRepairModal');
            if (e.target === modal) {
                closeBookingModal();
            }
        });
    </script>
</body>
</html>
